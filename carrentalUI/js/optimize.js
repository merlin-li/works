rental.optimization = (function() {  var optCase = [];  var startDate, endDate;  var timeDate = [];  function runOptimization() {    var startSelectedDate = new String(timeDate[0]);    var endSelectedDate = new String(timeDate[1]);        /*    $.getJSON(rental.constants.URL_RUN_OPTIMIZATION, {"from": startSelectedDate, "to": endSelectedDate}, function(data) {      if (rental.offline) {        if (optCase.length > 0) {          optCase.push(optCase[optCase.length - 1] + 1);        } else {          optCase.push(data.optcase);        }      } else {        optCase.push(data.optcase);      }            var oItem = new sap.ui.core.ListItem();      oItem.setText(String(optCase[optCase.length - 1]));      rental.ui.sComboBox.addItem(oItem);    });    */    var sdate,edate;    if (timeDate[0] != null && timeDate[0] != ""){      sdate = startSelectedDate.substring(6, 10)        + "-" + startSelectedDate.substring(3, 5)        + "-" + startSelectedDate.substring(0, 2)         + " 00:00:00";    }       if (timeDate[0] != null && timeDate[0] != ""){         edate = endSelectedDate.substring(6, 10)      + "-" + endSelectedDate.substring(3, 5)      + "-" + endSelectedDate.substring(0, 2)       + " 00:00:00";    }    $.getJSON(rental.constants.URL_RUN_OPTIMIZATION,       {        "begintimestamp": sdate,         "endtimestamp": edate,         "optcase": -1      }, function(data) {        //update map data        $.getJSON(rental.constants.URL_STATIC, {k: Math.random()}, function(costmodel) {          rental.depot.loadData(1, (new Date()).getDate(), costmodel.depot);        });    });  }      function displayOptimize(index) {    var fromLabel = new sap.ui.commons.Label({text: rental.util.getResourcesText("tabMapSliderBar_LbFrom") + " :", textAlign: "Right"});    //fromLabel.placeAt("from_label_" + index);        var toLabel = new sap.ui.commons.Label({width: '100%', text: rental.util.getResourcesText("tabMapSliderBar_LbTo") + " :", textAlign: "Right"});       startDate = new sap.ui.commons.DatePicker({width: "100%"});    startDate.attachChange(function(olistener) {      timeDate[0] = this.getValue();    });        var startDayLayout = new sap.ui.commons.layout.HorizontalLayout({      content: [fromLabel, startDate]    }).addStyleClass("optDatePickr");        endDate = new sap.ui.commons.DatePicker({width: "100%", locale:"zh_CN"});    endDate.attachChange(function(olistener) {      timeDate[1] = this.getValue();    });        var endDayLayout = new sap.ui.commons.layout.HorizontalLayout({      content: [toLabel, endDate]    }).addStyleClass("optDatePickr");;        var pickrLayout = new sap.ui.commons.layout.VerticalLayout({      content: [startDayLayout, endDayLayout]    }).setWidth("300px");        var runButton = new sap.ui.commons.Button({      text : rental.util.getResourcesText("optimizeTbRunbtnTitle"),      tooltip : rental.util.getResourcesText("optimizeTbRunbtnTooltip"),      press : function() {        runOptimization();      }    }).addStyleClass("runButton");        var wholeLayout = new sap.ui.commons.layout.HorizontalLayout({      content: [pickrLayout, runButton]    });        rental.ui.tabs[index]["optimizeTab"].addContent(wholeLayout);      }    return {    showOpmization: function(index) {      displayOptimize(index);      console.log(11);    },    getOptCase: function() {      return optCase;    },    getLastOptCase: function() {      return optCase[optCase.length - 1];    }  };})();